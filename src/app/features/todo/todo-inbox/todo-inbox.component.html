<div class="container-fluid todo-inbox">
  <div class="row">
    <div class="col-lg-12">
      <div class="iq-card iq-card-block iq-card-stretch iq-card-height">

        <ul class="nav nav-tabs" id="myTab-1" role="tablist">
          <li class="nav-item" *ngFor="let item of tabs[todoCurrentType]; let i = index">
            <a class="nav-link" id="home-tab" data-toggle="tab" role="tab" aria-controls="home" aria-selected="true"
              [routerLink]="item?.link" routerLinkActive="active">
              {{('' + item.name ) | translate | titlecase}}

              <!-- For Todos Other than Completed, Today, Pending-->
              <ng-container *ngIf="todoCurrentType !== TODOTYPES.completed && tabs[todoCurrentType].length < 2">
                <span *ngIf="queryStr">
                  {{ todos?.totalCount || '' }}
                </span>
                <span *ngIf="!queryStr">
                  {{(this.count) && this.count[item.name] || todos?.totalCount || ''}}
                </span>
              </ng-container>

              <!-- For Todos - Today, Pending-->
              <ng-container *ngIf="todoCurrentType !== TODOTYPES.completed && tabs[todoCurrentType].length === 2">
                <ng-container *ngIf="!queryStr">
                  <span *ngIf="todoCurrentType === item.name; else falsyTemplate">
                    <span>{{(this.count) && this.count[item.name] || todos?.totalCount || ''}}</span>
                  </span>
                  <ng-template #falsyTemplate>
                    <span *ngIf="i === 0">{{ this.count && this.count[TODOTYPES.today] || ''}}</span>
                    <span *ngIf="i === 1">{{ this.count && this.count[TODOTYPES.pending] || ''}}</span>
                  </ng-template>
                </ng-container>
                <ng-container *ngIf="queryStr">
                  <span *ngIf="todoCurrentType === item.name; else falsyTemplate">
                    <span>{{ todos?.totalCount || ''}}</span>
                  </span>
                  <ng-template #falsyTemplate>
                    <span *ngIf="i === 0">{{ this.count && this.count[TODOTYPES.today] || ''}}</span>
                    <span *ngIf="i === 1">{{ this.count && this.count[TODOTYPES.pending] || ''}}</span>
                  </ng-template>
                </ng-container>
              </ng-container>

              <!-- For Completed Todos-->
              <ng-container *ngIf="todoCurrentType === TODOTYPES.completed">
                {{(this.count) && this.count[item.name] || todos?.totalCount || ''}}
              </ng-container>
            </a>
          </li>
        </ul>

        <!-- Loader on fetching data-->
        <div class="col-sm-12 text-center" *ngIf="todoCurrentType !== TODOTYPES?.completed && extraLoader">
          <img [src]="loaderImage" alt="loader" style="height: 100px;">
        </div>
        <!--END-->

        <div class="iq-card-body" *ngIf="!extraLoader && todoCurrentType !== TODOTYPES?.completed">

          <!-- <ul class="list-group list-group-flush" cdkDropList [cdkDropListData]="todos?.data"
            (cdkDropListDropped)="onTodoDrop($event)" cdkDropListOrientation="horizontal"> -->
          <ul class="perfomer-lists m-0 p-0">
            <ng-container>
              <ng-container *ngFor="let todo of todos?.data; let i = index">
                <!-- <li class="list-group-item tr-{{ i + 1}} cursor" data-toggle="modal" data-target="#todo-dialog"
                  (click)="openPopUp(todo)" cdkDropList [id]="todo._id" [cdkDropListData]="todo"
                  [cdkDropListConnectedTo]="trackIds" (cdkDropListDropped)="onTodoDrop($event)" cdkDrag> -->
                <li class="d-flex mb-4 align-items-center tr-{{ i + 1}}" (click)="openPopUp(todo)" style="border-bottom: 1px solid #cccc;
                padding-bottom: 10px;">

                  <div class="user-img img-fluid">
                    <div class="custom-control custom-checkbox custom-control-inline flota-l mr-2"
                      style="padding-left: 0px; margin-top: 5px;">
                      <!-- <i class="fa fa-arrows flota-l" aria-hidden="true" cdkDragHandle></i> -->
                    </div>
                    <div class="custom-control custom-checkbox custom-control-inline flota-l"
                      (click)="$event.stopPropagation(); updateTodo(todo)">
                      <input type="checkbox" class="custom-control-input" id="customCheck-f{{i+1}}"
                        [checked]="todo?.isCompleted">
                      <label class="custom-control-label" for="customCheck-f{{i+1}}"></label>
                    </div>
                  </div>
                  <div class="media-support-info ml-3">
                    <h6>
                      <span>
                        <span [ngStyle]="todo?.isCompleted && {'text-decoration': 'line-through'}"
                          class="mr-2">{{todo?.title}}
                        </span>
                      </span>
                    </h6>
                    <p class="mb-0 font-size-12">
                      <span *ngFor="let label of todo?.labels"
                        class="badge border border-primary text-primary mt-2 mr-2">#{{label?.name}}</span>
                    </p>
                  </div>
                  <div class="iq-card-header-toolbar d-flex align-items-center">
                    <ng-container
                      *ngIf="todoCurrentType == TODOTYPES?.pending || todoCurrentType === TODOTYPES?.inbox || todoCurrentType === TODOTYPES?.today || todoCurrentType === TODOTYPES?.upcoming">
                      <span *ngIf="todo?.project?.name" [routerLink]="['/tasks/labels', todo.project.name]"
                        class="badge badge-primary ml-2 mr-2 cursor">{{todo?.project?.name}}
                      </span>
                      <span
                        [ngClass]="(checkScheduledDate(todo?.scheduledDate))? 'border-warning text-warning': 'border-danger text-danger'"
                        *ngIf="todoCurrentType !== TODOTYPES?.pending && todoCurrentType !== TODOTYPES?.today && todo?.scheduledDate">
                        {{displayDate(todo?.scheduledDate)}}
                      </span>
                      <span class="border-danger text-danger"
                        *ngIf="todoCurrentType === TODOTYPES?.pending && todo?.scheduledDate">
                        {{displayDate(todo?.scheduledDate)}}
                      </span>
                    </ng-container>
                    <span class="text-primary">
                      <ng-container>
                        <div class=" ml-auto  ml-4">
                          <button type="button" class="close ml-4" data-dismiss="alert" aria-label="Close"
                            (click)="$event.stopPropagation(); deleteRequest(todo)">
                            <span *ngIf="todo?.deleteRequest" (click)="$event.stopPropagation(); deleteTodo(todo)"
                              class="text-primary"> <i class="fa fa-info-circle mr-2" aria-hidden="true"></i>
                              click to confirm</span>
                            <i *ngIf="!todo?.deleteRequest" class="fa fa-minus-circle cursor" aria-hidden="true"></i>
                          </button>
                        </div>
                      </ng-container>
                    </span>
                  </div>
                  <hr class="mt-2 mb-2">
                </li>
              </ng-container>
            </ng-container>
          </ul>
        </div>

        <!-- Section for Completed Todos-->
        <div class="iq-card-body" *ngIf="!extraLoader && todoCurrentType === TODOTYPES?.completed">
          <app-infinite-scroll (scrolled)="refresh()">
            <app-todo-completed [todos]="todosC"></app-todo-completed>
            <div class="col-sm-12 text-center" *ngIf="loader">
              <img src="{{loaderImage}}" alt="loader" style="height: 100px;">
            </div>
          </app-infinite-scroll>
        </div>
      </div>
    </div>
  </div>
</div>